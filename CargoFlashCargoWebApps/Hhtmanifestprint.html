<!DOCTYPE html>
<html>
<head>
    <link href="../Styles/printmawb.css" type="text/css" rel="stylesheet" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="MSHTML 6.00.3790.1830" name="GENERATOR" />
    <!--<script src="Scripts/jspdf.debug.js"></script>
    <script src="Scripts/jspdf.min.js"></script>-->
    <script src="Scripts/jquery-1.7.2.js"></script>
    <script src="Scripts/html2canvas.js"></script>
    <script src="Scripts/jspdf.debug.js"></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>-->
    <!--<script src="Scripts/docraptor-1.0.0.js"></script>-->
    <script type='text/javascript'>
        //$(document).ready(function () {
        //    if (window.opener)
        //        userContext = window.opener.parent.userContext;
        //});
        var downloadPDF = function () {
            let doc = new jsPDF('p', 'pt', 'a4');
            doc.setFontSize(12);
            doc.addHTML(document.body, function () {
                doc.save('Manifest.pdf');
            });
        }
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        ////////////////////////////////////////
        function isBase64(str) {
            try {
                return btoa(atob(str)) == str;
            }
            catch (err) {
                return false;
            }
        }
        function ImageToBase64(image_src, mime_type) {
            // New Canvas
            var canvas = document.createElement('canvas');
            canvas.width = image_src.width;
            canvas.height = image_src.height;
            // Draw
            var ctx = canvas.getContext('2d');
            ctx.drawImage(image_src, 0, 0);
            // Image Base64
            return canvas.toDataURL(mime_type);
        }

        //var doc = new jsPDF();
        //var specialElementHandlers = {
        //    '#editor': function (element, renderer) {
        //        return true;
        //    }
        //};

        //$('#cmd').click(function () {
        //    doc.fromHTML($('#content').html(), 15, 15, {
        //        'width': 170,
        //        'elementHandlers': specialElementHandlers
        //    });
        //    doc.save('sample-file.pdf');
        //});
        $(document).ready(function () {

            var DailyFlightSNo = getParameterByName("DailyFlightSNo", "");
            var Type = getParameterByName("Type", "");
            var IsCart = getParameterByName("IsCart", "");
            var ICMSEnvironment = getParameterByName("ICMSEnvironment", "");
            var ClientEnvironment = getParameterByName("ClientEnvironment", "");
            var FC_AirlineName = getParameterByName("FC_AirlineName", "");
            var FC_AllowedCity = getParameterByName("FC_AllowedCity", "");
            var IsManifestFooterForAirAsia = getParameterByName("IsManifestFooterForAirAsia", "");
            var NewManifestPrint = getParameterByName("NewManifestPrint", "");


            //For decrypt
            if (isBase64(DailyFlightSNo))
                DailyFlightSNo = atob(DailyFlightSNo);
            if (isBase64(Type))
                Type = atob(Type);
            if (isBase64(IsCart))
                IsCart = atob(IsCart)
            if (isBase64(ICMSEnvironment))
                ICMSEnvironment = atob(ICMSEnvironment)
            if (isBase64(ClientEnvironment))
                ClientEnvironment = atob(ClientEnvironment)
            if (isBase64(FC_AirlineName))
                FC_AirlineName = atob(FC_AirlineName)
            if (isBase64(FC_AllowedCity))
                FC_AllowedCity = atob(FC_AllowedCity)
            if (isBase64(IsManifestFooterForAirAsia))
                IsManifestFooterForAirAsia = atob(IsManifestFooterForAirAsia)
            if (isBase64(NewManifestPrint))
                NewManifestPrint = atob(NewManifestPrint)


            var url;
            $.ajax({
                url: "Services/FlightControl/FlightControlService.svc/GetHHTManifestReport?DailyFlightSNo=" + DailyFlightSNo + "&ICMSEnvironment=" + ICMSEnvironment
                    + "&ClientEnvironment=" + ClientEnvironment + "&FC_AirlineName=" + FC_AirlineName + "&FC_AllowedCity=" + FC_AllowedCity + "&IsManifestFooterForAirAsia=" + IsManifestFooterForAirAsia + "&NewManifestPrint=" + NewManifestPrint + "&Type=" + Type + "&IsCart=" + IsCart, async: false, type: "get", dataType: "html", cache: false,
                contentType: "application/json; charset=utf-8",
                success: function (result) {


                    if (result.split('?')[0] == '1') {
                        // ShowMessage('warning', 'Warning -Shipment ', result.split('?')[1], "bottom-right");
                    }
                    else {
                        $("#content").append(result);
                        setTimeout(function () {
                            $('div.content > img').css({ 'height': '120px' });
                            downloadPDF()
                        }, 300)

                    }
                },
                error: {

                }
            });

        });
    </script>
</head>

<body>
    <div id="content">

    </div>
    <!--<input id="pdf-button" type="button" value="Download PDF" onclick="downloadPDF()" />-->
</body>
</html>

